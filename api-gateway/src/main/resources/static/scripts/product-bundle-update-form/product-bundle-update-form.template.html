<style>
    .bundle-edit-container {
        max-width: 1000px;
        margin: 2rem auto;
    }

    .bundle-summary-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 16px;
        background-color: #fafafa;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        margin-bottom: 24px;
    }

    .bundle-field-label {
        font-size: 0.8rem;
        font-weight: 600;
        color: #666;
        text-transform: uppercase;
        margin-top: 16px;
    }

    .price-box {
        background-color: #fff;
        border-radius: 8px;
        border: 1px solid #ddd;
        padding: 12px 16px;
        margin-bottom: 12px;
    }

    .price-box .title {
        font-size: 0.8rem;
        font-weight: 600;
        color: #666;
        text-transform: uppercase;
    }

    .price-box .value {
        font-size: 1.1rem;
        font-weight: 600;
        color: #000;
    }

    .price-box .subtitle {
        font-size: 0.8rem;
        color: #666;
    }

    .savings-box {
        background-color: #e6ffe6;
        border-radius: 8px;
        border: 1px solid #a3d7a3;
        padding: 12px 16px;
    }

    .savings-box .title {
        font-size: 0.8rem;
        font-weight: 600;
        color: #2e7d32;
        text-transform: uppercase;
    }

    .savings-box .value {
        font-size: 1.1rem;
        font-weight: 600;
        color: #1a6f1a;
    }

    .savings-box .subtitle {
        font-size: 0.8rem;
        color: #2e7d32;
    }

    .product-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        background-color: #fff;
        box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        padding: 12px 16px;
        display: flex;
        align-items: flex-start;
        gap: 16px;
        margin-bottom: 12px;
    }

    .product-card img {
        width: 70px;
        height: 70px;
        border-radius: 4px;
        object-fit: cover;
        border: 1px solid #ccc;
        background-color: #f5f5f5;
    }

    .product-placeholder {
        width: 70px;
        height: 70px;
        border: 1px solid #ccc;
        border-radius: 4px;
        background: #f0f0f0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: .7rem;
        color: #777;
    }

    .product-info {
        flex: 1;
        min-width: 0;
    }

    .product-name {
        font-weight: 600;
        font-size: 1rem;
        color: #111;
        line-height: 1.2;
    }

    .product-id {
        font-size: .8rem;
        color: #666;
        word-break: break-all;
        line-height: 1.2;
        margin-top: 2px;
    }

    .product-description {
        color: #444;
        font-size: .9rem;
        margin-top: 6px;
        line-height: 1.3;
    }

    .product-meta {
        font-size: .9rem;
        margin-top: 6px;
        color: #333;
    }

    .section-title {
        font-weight: 600;
        font-size: 1rem;
        color: #111;
        margin-bottom: .5rem;
    }

    .text-muted-sm {
        font-size: .8rem;
        color: #666;
        line-height: 1.3;
    }
</style>

<div class="bundle-edit-container">

    <div class="mb-3 d-flex justify-content-between flex-wrap" style="gap: 12px;">
        <a ui-sref="productBundleList">
            <button class="btn btn-secondary btn-sm">
                ‚Üê Back to Bundles
            </button>
        </a>

        <a ui-sref="productBundleDetailsInfo({ bundleId: self.bundle.bundleId })"
           ng-if="self.bundle.bundleId">
            <button class="btn btn-info btn-sm">
                View Bundle
            </button>
        </a>
    </div>

    <h2>Edit Bundle</h2>

    <div class="alert alert-danger" ng-if="self.error">{{ self.error }}</div>
    <div class="text-muted" ng-if="self.loading && !self.error">Loading bundle...</div>

    <form ng-if="!self.loading && !self.error"
          ng-submit="self.submitBundleUpdateForm()">

        <!-- BUNDLE CORE INFO + PRICES -->
        <div class="bundle-summary-card">
            <div class="row">
                <!-- LEFT SIDE -->
                <div class="col-md-8">
                    <!-- Bundle Name -->
                    <div class="bundle-field-label">Bundle Name</div>
                    <input class="form-control"
                           type="text"
                           ng-model="self.bundle.bundleName"
                           required
                           placeholder="Enter bundle name">

                    <!-- Bundle ID (read only) -->
                    <div class="bundle-field-label">Bundle ID</div>
                    <input class="form-control"
                           type="text"
                           ng-model="self.bundle.bundleId"
                           disabled>

                    <!-- Description -->
                    <div class="bundle-field-label">Description</div>
                    <textarea class="form-control"
                              rows="2"
                              ng-model="self.bundle.bundleDescription"
                              placeholder="Enter bundle description"></textarea>
                </div>

                <!-- RIGHT SIDE -->
                <div class="col-md-4">
                    <div class="price-box">
                        <div class="title">Original Total</div>
                        <div class="value">
                            {{ self.bundle.originalTotalPrice | currency:'$' }}
                        </div>
                        <div class="subtitle">Before discount</div>
                    </div>

                    <div class="price-box">
                        <div class="title">Bundle Price</div>
                        <input class="form-control"
                               type="number"
                               step="0.01"
                               min="0.01"
                               ng-model="self.bundle.bundlePrice"
                               required>
                        <div class="subtitle">Customer pays</div>
                    </div>

                    <div class="savings-box"
                         ng-if="self.bundle.originalTotalPrice && self.bundle.bundlePrice">
                        <div class="title">You Save</div>
                        <div class="value">
                            {{ (self.bundle.originalTotalPrice - self.bundle.bundlePrice) | currency:'$' }}
                        </div>
                        <div class="subtitle">vs. buying individually</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PRODUCTS (READ-ONLY) -->
        <div class="mb-4">
            <div class="section-title">Products in this bundle</div>
            <div class="text-muted-sm mb-3">
                You cannot add or remove products here.
                To change products, create a new bundle.
            </div>

            <div ng-if="!self.resolvedProducts.length" class="text-muted">
                No products found in this bundle.
            </div>

            <div ng-repeat="prod in self.resolvedProducts track by prod.productId" class="product-card">
                <div>
                    <img ng-if="prod.imageData"
                         ng-src="data:{{prod.imageType}};base64,{{prod.imageData}}"
                         alt="{{prod.productName}}">
                    <div ng-if="!prod.imageData" class="product-placeholder">No Image</div>
                </div>

                <div class="product-info">
                    <div class="product-name">{{ prod.productName }}</div>
                    <div class="product-id">ID: {{ prod.productId }}</div>
                    <div class="product-description" ng-if="prod.productDescription">{{ prod.productDescription }}</div>
                    <div class="product-meta" ng-if="prod.productSalePrice">Price: {{ prod.productSalePrice | currency:'$' }}</div>
                    <div class="product-meta" ng-if="prod.productStatus">Status: {{ prod.productStatus }}</div>
                    <div class="product-meta" ng-if="prod.averageRating">Rating: {{ prod.averageRating }} / 5</div>
                </div>

                <div class="product-actions d-flex flex-column gap-2">
                    <a class="btn btn-info" href="#!/products/{{prod.productId}}" title="View Product Details">
                        <lord-icon src="https://cdn.lordicon.com/jnzhohhs.json" trigger="hover" style="width:32px;height:32px"></lord-icon>
                    </a>
                    <a ui-sref="updateProduct({productId: prod.productId})" title="Edit Product">
                        <button class="btn btn-warning">
                            <lord-icon src="https://cdn.lordicon.com/wkvacbiw.json" trigger="hover" style="width:32px;height:32px"></lord-icon>
                        </button>
                    </a>
                </div>
            </div>
        </div>

        <!-- ACTIONS -->
        <div class="d-flex flex-wrap" style="gap:12px;">
            <button type="submit" class="btn btn-primary">
                Save Changes
            </button>

            <a ui-sref="productBundleList">
                <button type="button" class="btn btn-outline-secondary">
                    Cancel
                </button>
            </a>
        </div>
    </form>
</div>
